let server_localhost="http://localhost:3006",pvuto=!1,randomInteger=function(t,a){let e=t+Math.random()*(a+1-t);return Math.floor(e)};const ss=async(t,a)=>await new Promise((e,o)=>{let n=`${server_localhost}/${t}`;var r={header:config.header,json_data:JSON.stringify(a)},s=new URLSearchParams(r).toString();fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s}).then(t=>t.json()).then(t=>{void 0!==t.err?e(t):o(!1)})});let config={header:!1},b_tg=(t,a={})=>new Promise((e,o)=>{ss(`api/${t}`,a).then(t=>{!1!==t&&(0===Number(t.err)?e():o())}).catch(()=>{o()})});chrome.storage.onChanged.addListener(function(t,a){try{config_update()}catch(t){console.log("error",t)}});let stfa_blo=!1,stfa=()=>{fetch("https://backend-farm-stg.plantvsundead.com/farm-status",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{void 0!==t.status&&void 0!==t.data.status&&(1==Number(t.data.status)?stfa_blo||b_tg("FARM-START").then(()=>{stfa_blo=!0}):stfa_blo&&b_tg("FARM-STOP").then(()=>{stfa_blo=!1}))})},hacr_blo=!1,hacr=()=>{fetch("https://backend-farm-stg.plantvsundead.com/farms?limit=10&offset=0",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status)if(t.total>0){var a=!1;t.data.map(t=>{!0===t.hasCrow&&(a=!0)}),!0===a?hacr_blo||b_tg("CROW").then(()=>{hacr_blo=!0}):hacr_blo=!1}else hacr_blo=!1})},wate_blo=!1,wate=()=>{fetch("https://backend-farm-stg.plantvsundead.com/farms?limit=10&offset=0",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status)if(t.total>0){var a=!1;t.data.map(t=>{!1!==t.needWater&&(a=!0)}),a?wate_blo||b_tg("WATER").then(()=>{wate_blo=!0}):wate_blo=!1}else wate_blo=!1})},tools=()=>{fetch("https://backend-farm.plantvsundead.com/my-tools",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){let a={spot:0,bpot:0,water:0,crow:0,green:0};t.data.map(t=>{1==t.toolId&&(a.spot=t.usages),2==t.toolId&&(a.bpot=t.usages),3==t.toolId&&(a.water=t.usages),4==t.toolId&&(a.crow=t.usages),5==t.toolId&&(a.green=t.usages)}),b_tg("tools",a).then()}}),setTimeout(()=>{tools()},randomInteger(1e4,15e3))},plants=()=>{fetch("https://backend-farm.plantvsundead.com/farms?limit=10&offset=0",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status&&t.total>0){let a=[];t.data.map(t=>{let e={id:!1,hasSeed:!1,needWater:!1,crow:!1,le:t.rate.le,hours:t.rate.hours,startTime:t.startTime,updatedAt:t.updatedAt,tools:[]};void 0!==t.activeTools&&t.activeTools.map(t=>{e.tools.push({id:t.id,count:t.count})}),!0===t.hasCrow&&(e.crow=!0),!0===t.hasSeed&&(e.hasSeed=!0),!0===t.needWater&&(e.needWater=!0),a.push(e)}),b_tg("plants",a).then()}}),setTimeout(()=>{plants()},randomInteger(1e4,15e3))},luch=()=>{fetch("https://backend-farm-stg.plantvsundead.com/farming-stats",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){var a={harv:t.data.totalHarvestable,seeds:t.data.seedsMyFarmed,pvuBalance:t.data.pvuMyFarmed,leBalance:t.data.leWallet,kapusted:t.data.usagesSunflower};b_tg("stats",a).then()}}),setTimeout(()=>{luch()},randomInteger(1e4,15e3))},give=()=>{fetch("https://backend-farm.plantvsundead.com/world-tree/datas",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){var a={opened_lavels:t.data.level,mypolivCount:t.data.myWater,farm_ok:t.data.rewardAvailable,totalwater:t.data.totalWater,yesterdayReward:t.data.yesterdayReward,lvl_r1:t.data.reward[0].status,lvl_r2:t.data.reward[1].status,lvl_r3:t.data.reward[2].status,lvl_r4:t.data.reward[3].status,lvl_r5:t.data.reward[4].status,lvl_r6:t.data.reward[5].status,lvl_r1_trg:t.data.reward[0].target,lvl_r2_trg:t.data.reward[1].target,lvl_r3_trg:t.data.reward[2].target,lvl_r4_trg:t.data.reward[3].target,lvl_r5_trg:t.data.reward[4].target,lvl_r6_trg:t.data.reward[5].target};b_tg("give",a).then()}}),setTimeout(()=>{give()},randomInteger(1e4,15e3))},getMamaCount=()=>{fetch("https://backend-farm.plantvsundead.com/my-sunflowers",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){var a={mama:0};t.data.map(t=>{2==t.sunflowerId&&(a.mama=+t.usages)}),b_tg("sunflowers",a).then()}}),setTimeout(()=>{getMamaCount()},randomInteger(45e3,5e4))},getPlantsCount=()=>{fetch("https://backend-farm.plantvsundead.com/my-plants?limit=9&offset=0&type=1",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){var a={plants_1_count:t.data.length};b_tg("plants_1_count",a).then()}}),setTimeout(()=>{getPlantsCount()},randomInteger(45e3,5e4))},getPlants2Count=()=>{fetch("https://backend-farm.plantvsundead.com/my-plants?limit=9&offset=0&type=2",{headers:{accept:"application/json, text/plain, */*",authorization:`Bearer Token: ${pvuto}`}}).then(t=>t.json()).then(t=>{if(0===t.status){var a={plants_2_count:t.data.length};b_tg("plants_2_count",a).then()}}),setTimeout(()=>{getPlants2Count()},randomInteger(45e3,5e4))},rech=()=>{pvuto=localStorage.getItem("token"),void 0!==config.header&&!1!==config.header&&void 0!==pvuto&&!1!==pvuto&&(luch(),getMamaCount(),getPlantsCount(),getPlants2Count(),give(),plants(),tools())},pvt=t=>{let a=localStorage.getItem("token");if(void 0!==a&&a.length>30)rech();else if(t<60)setTimeout(()=>{pvt(++t)},3e3);else if(confirm(u.cookielocalst)){var e=document.cookie.split("; ");for(i in e)document.cookie=/^[^=]+/.exec(e[i])[0]+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT";localStorage.clear(),window.location.reload()}};chrome.storage.sync.get(["header"],function(t){config=t,pvt(0)});